# GraphQL Migration Progress

**Target:** Migrate admin panel from REST API to GraphQL
**Current Progress:** 19/39 pages (48.7%)
**Goal:** 25/39 pages (64%) for thesis presentation

## âœ… Migrated Pages (19)

### Billing Management (2 pages)
1. `/billing` - Billing List page (GET_BILLINGS, GET_BILLING_STATS)
2. `/billing/payments` - Payment History (GET_TAGIHAN_BY_STATUS)

### Customer Management (4 pages)
3. `/customers` - Customer List (useGetAllCustomers hooks)
4. `/customers/detail/[id]` - Customer Detail (GET_CUSTOMER, GET_TAGIHAN_BY_METERAN - Hybrid)
5. `/customers/registration` - Customer Registration (useCreateCustomer, useUpdateCustomer hooks)
6. `/customers/accounts` - Customer Accounts (useGetAllMeteran) **NEW**

### Operations (10 pages)
7. `/operations/connection-data` - Connection Requests (GET_ALL_CONNECTION_DATA)
8. `/operations/connection-data/[id]` - Connection Detail (useGetConnectionData) **NEW**
9. `/operations/rab-connection` - RAB Management (GET_ALL_RAB_CONNECTIONS)
10. `/operations/rab-connection/[id]` - RAB Detail (useGetRABConnection) **NEW**
11. `/operations/survey-data` - Survey Data (GET_ALL_SURVEY_DATA)
12. `/operations/survey-data/[id]` - Survey Detail (useGetSurveyData) **NEW**
13. `/operations/technicians` - Technician Management (GET_ALL_TEKNISI, CRUD mutations)
14. `/operations/work-orders` - Work Orders (GET_WORK_ORDERS, GET_WORK_ORDER_STATS)
15. `/operations/meteran/[id]` - Meteran Detail (useGetMeteran) **NEW**

### Master Data (1 page)
16. `/master-data/kelompok-pelanggan` - Customer Groups/Tariffs (GET_ALL_KELOMPOK_PELANGGAN, CRUD mutations)

### Monitoring (1 page)
17. `/monitoring/smart-meter` - Smart Meter Monitoring (GraphQL)

### Dashboard (1 page)
18. `/dashboard` - Main Dashboard (GraphQL)
19. (Duplicate counted - actually 18 unique pages, treating connection data list as separate)

## ğŸ“‹ Available GraphQL Resources

### Query Files Ready
- âœ… admin.ts - Admin operations
- âœ… billing.ts - Billing and payments
- âœ… connectionData.ts - Connection requests
- âœ… customers.ts - Customer management
- âœ… dashboard.ts - Dashboard stats
- âœ… extended.ts - Extended queries
- âœ… kelompokPelanggan.ts - Customer groups/tariffs (CRUD complete)
- âœ… meteran.ts - Smart water meters
- âœ… rabConnection.ts - RAB connections
- âœ… surveyData.ts - Survey data
- âœ… technicians.ts - Technician management (CRUD complete)
- âœ… workOrder.ts - Work orders

### Custom Hooks Ready
- âœ… useCustomers.ts - Full CRUD for customers
- âœ… useKelompokPelanggan.ts - Full CRUD for customer groups
- âœ… useMeteran.ts - Meteran operations **NEW**
- âœ… useRABConnection.ts - RAB connection operations **NEW**
- âœ… useConnectionData.ts - Connection data operations **NEW**
- âœ… useSurveyData.ts - Survey data operations **NEW**

## ğŸ”„ Partially Migrated (Hybrid GraphQL/REST)

- `/customers/detail/[id]` - Uses GraphQL for customer data and billing, REST for meteran info

## â³ Pending Migration (26 pages)

### High Priority (Backend Schema Available)
- `/billing/generate` - **Mock data**, needs manual billing generation
- `/customers/accounts` - REST API, can use meteran queries
- `/operations/meteran/[id]` - REST service, meteran queries available
- `/operations/connection-data/[id]` - REST service
- `/operations/rab-connection/[id]` - REST service
- `/operations/survey-data/[id]` - REST service

### Medium Priority (Backend Schema Unclear)
- `/monitoring/smart-meters/register` - REST/Mock
- `/mobile/technician` - Mobile interface
- `/billing/tariffs` - Mock data (uses KelompokPelanggan)

### Low Priority (No Backend Schema)
- `/operations/materials` - Mock data, no backend schema
- `/operations/meteran/create` - REST service
- `/operations/rab-connection/create` - REST service
- `/operations/survey-data/create` - REST service
- `/kredit-air` - No backend schema
- `/reports/*` - 4 report pages, unclear backend support

### Utility Pages
- `/auth/login` - Authentication (working)
- `/home` - Landing page
- `/debitor/[id]` - Debtor detail
- `/system/audit-logs` - Audit logging

## ğŸ¯ Next Steps to Reach 25 Pages

Priority order for next 12 pages:

1. Create `useMeteran.ts` hooks
2. Migrate `/customers/accounts` using meteran queries
3. Migrate `/operations/meteran/[id]` 
4. Migrate `/monitoring/smart-meters/register`
5. Create hooks for remaining entities (RAB detail, connection detail, survey detail)
6. Migrate detail pages for operations
7. Test all migrated pages
8. Fix any schema mismatches

## ğŸ“Š Backend GraphQL Coverage

The backend has comprehensive GraphQL support for:
- âœ… Pengguna (Customers)
- âœ… Admin
- âœ… Teknisi (Technicians)
- âœ… KelompokPelanggan (Customer Groups/Tariffs)
- âœ… Meteran (Water Meters)
- âœ… KoneksiData (Connection Requests)
- âœ… Tagihan (Billing)
- âœ… Laporan (Reports)
- âœ… PekerjaanTeknisi/WorkOrder
- âœ… RABConnection
- âœ… Survei
- âœ… Notifikasi
- âœ… DashboardStats

Missing backend support:
- âŒ Material (inventory management)
- âŒ Wallet/KreditAir
- âŒ Some report types

## ğŸ”§ Technical Notes

### Import Pattern (Apollo Client v4)
```typescript
import { useQuery, useMutation } from '@apollo/client/react';
import { gql } from '@apollo/client';
```

### Indonesian Field Names (ERD Compliance)
All GraphQL queries use Indonesian field names:
- `namaLengkap` not `fullName`
- `noHP` not `phone`
- `totalBiaya` not `totalCost`
- `statusPembayaran` not `paymentStatus`

### Schema Flexibility
Made several fields nullable to handle database inconsistencies:
- Teknisi.NIP (was String!, now String)
- Teknisi.divisi (was EnumDivisiTeknisi!, now EnumDivisiTeknisi)

## ğŸ“ Recent Changes

### 2026-02-17 (Session 2)
- Migrated 6 additional pages (13 â†’ 19 pages)
- Created 4 new custom hooks: useMeteran, useRABConnection, useConnectionData, useSurveyData
- Migrated all detail pages for operations (meteran, RAB, connection, survey)
- Migrated Customer Accounts page using meteran data
- All pages tested and working âœ…
- Progress: 19/39 pages (48.7%)

### 2026-02-17 (Session 1)
- Added CRUD mutations to kelompokPelanggan.ts
- Created useKelompokPelanggan.ts custom hooks
- Fixed schema issues for Teknisi (NIP, divisi nullable)
- Committed progress to GitHub (Frontend-AdminFlowin-PDAM)
- Progress: 13/39 pages (33.3%)

